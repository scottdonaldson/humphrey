Humphrey.DOM.posts=document.getElementById("posts"),Humphrey.DOM.title=document.getElementById("title"),Humphrey.DOM.textarea=document.getElementById("data"),Humphrey.DOM.file=document.getElementById("file"),Humphrey.DOM.button=document.getElementById("upload-button"),function(a){Humphrey.loadPosts=function(){Humphrey.S3.listObjects({Prefix:"posts/"},function(b,c){c.Contents||(c.Contents=[]),c.Contents.forEach(function(b){var c=b.Key;b.Size>0&&Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:c},function(b,d){if(b&&console.log(b),d){var e=JSON.parse(d.Body.toString()),f=c.replace(/^posts\/|.json$/g,""),g=new Option(e.title,f);a.posts.appendChild(g)}})}),a.posts.addEventListener("change",Humphrey.updateView),a.button.addEventListener("click",Humphrey.updatePost)})},Humphrey.updateView=function(){Humphrey.SITE.activePost=this.value,Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:"posts/"+Humphrey.SITE.activePost+".json"},function(b,c){if(b&&console.log(b),c){var d=JSON.parse(c.Body.toString()),e=new Date(d.updated);title.value=d.title,a.textarea.innerHTML=d.content,Humphrey.UTILS.notify("Last updated: "+Humphrey.UTILS.formatDate(e))}})},Humphrey.updatePostJSON=function(){var b=Humphrey.UTILS.slugify(a.title),c=a.title.value,d=a.textarea.value,e=a.file.files?a.file.files[0].name:!1,f={Key:"posts/"+b+".json",ContentType:"application/json",Body:JSON.stringify({content:d,title:c,media:e,updated:new Date})};Humphrey.S3.putObject(f,function(a){Humphrey.UTILS.notify(a?"DATA ERROR!":"DATA SAVED.",!0)})},Humphrey.renderPost=function(){},Humphrey.updatePost=function(){Humphrey.UTILS.notify("");var b=a.textarea.value,c=Humphrey.SITE.activePost?Humphrey.SITE.activePost:Humphrey.UTILS.slugify(a.title.value),d=a.file.files?a.file.files[0]:!1;d&&Humphrey.addMedia(d),Humphrey.updatePostJSON();var e=Humphrey.SITE.activeThemeHeader,f=Humphrey.SITE.activeThemeFooter,g={title:title.value,date:Humphrey.UTILS.formatDate(new Date)};e=Humphrey.filterContent(e,g),b=Humphrey.filterContent(b,g),f=Humphrey.filterContent(f,g),params={Body:e+b+f,ContentType:"text/html",Key:"site/"+c+"/index.html"},Humphrey.S3.putObject(params,function(a){Humphrey.UTILS.notify(a?"POST ERROR!":"POST SAVED.",!0)})}}(Humphrey.DOM);