Humphrey.DOM.posts=document.getElementById("posts"),Humphrey.DOM.title=document.getElementById("title"),Humphrey.DOM.textarea=document.getElementById("data"),Humphrey.DOM.button=document.getElementById("upload-button"),function(a){Humphrey.loadPosts=function(){Humphrey.S3.listObjects({Prefix:"posts/"},function(b,c){c.Contents||(c.Contents=[]),c.Contents.forEach(function(b){var c=b.Key;b.Size>0&&Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:c},function(b,d){if(b&&console.log(b),d){var e=JSON.parse(d.Body.toString()),f=c.replace(/^posts\/|.json$/g,""),g=new Option(e.title,f);a.posts.appendChild(g)}})}),a.posts.addEventListener("change",Humphrey.updateView),a.button.addEventListener("click",Humphrey.updatePost)})},Humphrey.updateView=function(){Humphrey.SITE.activePost=this.value,Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:"posts/"+Humphrey.SITE.activePost+".json"},function(b,c){if(b&&console.log(b),c){var d=JSON.parse(c.Body.toString()),e=new Date(d.updated);title.value=d.title,a.textarea.innerHTML=d.content,Humphrey.UTILS.notify("Last updated: "+Humphrey.UTILS.formatDate(e))}})},Humphrey.updatePost=function(){Humphrey.UTILS.notify("");var b=a.textarea.value;Humphrey.SITE.activePost=Humphrey.SITE.activePost?Humphrey.SITE.activePost:Humphrey.UTILS.slugify(title.value);var c={Key:"posts/"+Humphrey.SITE.activePost+".json",Body:JSON.stringify({content:b,title:title.value,updated:new Date})};Humphrey.S3.putObject(c,function(a){Humphrey.UTILS.notify(a?"DATA ERROR!":"DATA SAVED.",!0)});var d=Humphrey.SITE.activeThemeHeader,e=Humphrey.SITE.activeThemeFooter,f={title:title.value,date:Humphrey.UTILS.formatDate(new Date)};d=Humphrey.filterContent(d,f),b=Humphrey.filterContent(b,f),e=Humphrey.filterContent(e,f),c={Body:d+b+e,ContentType:"text/html",Key:"site/"+Humphrey.SITE.activePost+"/index.html"},Humphrey.S3.putObject(c,function(a){Humphrey.UTILS.notify(a?"POST ERROR!":"POST SAVED.",!0)})}}(Humphrey.DOM);