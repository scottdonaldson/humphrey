Humphrey.DOM.themes=document.getElementById("themes"),Humphrey.DOM.themeHeader=document.getElementById("theme-header"),Humphrey.DOM.themeFooter=document.getElementById("theme-footer"),Humphrey.DOM.updateThemeButton=document.getElementById("update-theme"),function(a){Humphrey.loadThemes=function(){Humphrey.S3.listObjects({Prefix:"admin/themes/"},function(b,c){for(var d=0;d<c.Contents.length;d++){var e=c.Contents[d];0===e.Size&&"admin/themes/"!==e.Key&&Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:e.Key+"style.css"},function(a,b){var c=b.Body.toString(),d=c.slice(c.indexOf("Theme Name: ")+"Theme Name: ".length),f=d.slice(0,d.indexOf("\n")),g=new Option(f,e.Key.replace(/^admin\/themes\/|\/style.css/g,""));themes.appendChild(g)})}Humphrey.setActiveTheme(),a.updateThemeButton.addEventListener("click",Humphrey.updateTheme)})},Humphrey.setActiveTheme=function(){a.themes.value=Humphrey.SITE.activeTheme;Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:"admin/themes/"+Humphrey.SITE.activeTheme+"/header.html"},function(b,c){Humphrey.SITE.activeThemeHeader=c.Body.toString(),a.themeHeader.innerHTML=Humphrey.SITE.activeThemeHeader}),Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:"admin/themes/"+Humphrey.SITE.activeTheme+"/footer.html"},function(b,c){Humphrey.SITE.activeThemeFooter=c.Body.toString(),a.themeFooter.innerHTML=Humphrey.SITE.activeThemeFooter})},Humphrey.switchTheme=function(){a.themes.value},Humphrey.stageTheme=function(){console.log("updating SITE active theme header/footer"),Humphrey.SITE.activeThemeHeader=a.themeHeader.value,Humphrey.SITE.activeThemeFooter=a.themeFooter.value,console.log(Humphrey.SITE.activeThemeHeader)},Humphrey.updateTheme=function(){var a=Humphrey.SITE.activeThemeHeader,b=Humphrey.SITE.activeThemeFooter,c={Body:a,ContentType:"text/html",Key:"admin/themes/"+Humphrey.SITE.activeTheme+"/header.html"};Humphrey.S3.putObject(c,function(){}),c.Body=b,c.Key="admin/themes/"+Humphrey.SITE.activeTheme+"/footer.html",Humphrey.S3.putObject(c,function(){}),Humphrey.UTILS.notify("Updating theme: "+Humphrey.SITE.activeTheme+"."),Humphrey.S3.listObjects({Prefix:"posts/"},function(d,e){e.Contents||(e.Contents=[]),e.Contents.forEach(function(d){d.Size>0&&Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:d.Key},function(e,f){if(e&&console.log(e),f){var g=JSON.parse(f.Body.toString()),h=g.title,i=g.content,j=d.Key.replace(/^posts\/|.json$/g,""),k={title:h,date:Humphrey.UTILS.formatDate(new Date)};a=Humphrey.filterContent(a,k),i=Humphrey.filterContent(i,k),b=Humphrey.filterContent(b,k),Humphrey.UTILS.notify("Updating post: "+h+".",!0),c={Body:a+i+b,ContentType:"text/html",Key:"site/"+j+"/index.html"},Humphrey.S3.putObject(c,function(){})}})})})},a.themeHeader.addEventListener("change",Humphrey.stageTheme),a.themeFooter.addEventListener("change",Humphrey.stageTheme)}(Humphrey.DOM);