Humphrey.DOM.siteName=$("#site-name"),Humphrey.DOM.themes=$("#themes"),Humphrey.DOM.updateSiteButton=$("#update-site"),function(a){Humphrey.setSiteConfig=function(){Humphrey.setSiteName(),Humphrey.setActiveTheme(),Humphrey.loadActiveTheme()},Humphrey.setSiteName=function(){var b=Humphrey.SITE.siteName?Humphrey.SITE.siteName:"";a.siteName.val(b),a.updateSiteButton.on("click",Humphrey.updateSiteName)},Humphrey.updateSiteName=function(){Humphrey.SITE.siteName=a.siteName.val();var b=JSON.stringify(Humphrey.SITE);Humphrey.S3.putObject({Key:"admin/site.json",ContentType:"application/json",Body:b},noop)},Humphrey.loadThemes=function(){Humphrey.S3.listObjects({Prefix:"admin/themes/"},function(b,c){c.Contents||(c.Contents=[]),c.Contents.forEach(function(b){0===b.Size&&"admin/themes/"!==b.Key&&Humphrey.S3.getObject({Bucket:Humphrey.BUCKET,Key:b.Key+"style.css"},function(c,d){var e=d.Body.toString(),f=e.slice(e.indexOf("Theme Name: ")+"Theme Name: ".length),g=f.slice(0,f.indexOf("\n")),h=$('<option value="'+b.Key.replace("admin/themes/","").replace("/","")+'">'+g+"</option>");a.themes.append(h)})}),Humphrey.setActiveTheme(),a.updateSiteButton.addEventListener("click",Humphrey.switchTheme)})},Humphrey.setActiveTheme=function(){a.themes.value=Humphrey.SITE.activeTheme.name},Humphrey.loadThemeFile=function(a,b,c,d){console.log(a),Humphrey.S3.getObject({Key:a.Key},function(e,f){if(e&&console.log(e),f){var g=a.Key.split("/");g=g[g.length-1],Humphrey.SITE.activeTheme.files||(Humphrey.SITE.activeTheme.files={}),Humphrey.SITE.activeTheme.files[g]=f.Body.toString(),b++,c[b]?Humphrey.loadThemeFile(c[b],b,c,d):d()}})},Humphrey.loadActiveTheme=function(a){Humphrey.S3.listObjects({Bucket:Humphrey.BUCKET,Prefix:"admin/themes/"+Humphrey.SITE.activeTheme.name+"/"},function(b,c){b&&console.log(b),c&&(c.Contents||(c.Contents=[]),c.Contents[1]&&Humphrey.loadThemeFile(c.Contents[1],1,c.Contents,function(){console.log("finished adding theme files")}),a&&a(Humphrey.activeThemeFiles))})},Humphrey.switchTheme=function(){a.themes.value;Humphrey.SITE.activeTheme.name=a.themes.value;var b=JSON.stringify(Humphrey.SITE);console.log("switching theme. new site data:",b),Humphrey.S3.putObject({Key:"admin/site.json",ContentType:"application/json",Body:b},noop)}}(Humphrey.DOM);